<style>
  /* Base styles for nav-collapse: hidden but rendered */
  .nav-collapse {
    opacity: 0;
    visibility: hidden;
    transition: opacity 2s ease, visibility 2s ease;
  }

  /* When nav is expanded (mobile toggle) */
  .navbar-custom.nav-expanded .nav-collapse {
    opacity: 1;
    visibility: visible;
  }

  /* Desktop hover styles for >= 992px screens */
  @media (min-width: 992px) {
    .navbar-custom:hover .nav-collapse {
      opacity: 1;
      visibility: visible;
    }

    .navbar-custom:not(:hover) .nav-collapse {
      opacity: 0;
      visibility: hidden;
    }
  }
</style>

<nav id="main-navbar" class="navbar navbar-light fixed-top navbar-custom px-4 py-3 flex-column align-items-start" style="background-color: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); z-index: 1000;" role="navigation" aria-label="Main navigation">

  <!-- Title or Logo -->
  <div class="container-fluid w-100 d-flex justify-content-between align-items-center">
    <div>
      {%- if site.title-img -%}
        <a class="navbar-brand mb-0" href="{{ '/' | absolute_url }}">
          <img alt="{{ site.title }} Logo" src="{{ site.title-img | relative_url }}" style="max-height: 40px;" />
        </a>
      {%- elsif site.title -%}
        <a class="navbar-brand fs-3 fw-bold mb-0" href="{{ '/' | absolute_url }}">{{ site.title }}</a>
      {%- endif -%}
    </div>

    <!-- Expand Button -->
    <button id="expandToggle" class="btn btn-outline-secondary btn-sm ms-auto d-lg-none" aria-expanded="false" aria-controls="nav-collapse">
      â˜° Menu
    </button>
  </div>

  <!-- Collapsible Navigation Links -->
  <div class="nav-collapse mt-3 w-100" id="nav-collapse">
    <div class="row gx-3 gy-2 justify-content-center">
      {%- for link in site.navbar-links -%}
        <div class="col-auto">
          {% if link[1].first %}
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle px-2" href="#" id="navbarDropdown-{{ forloop.index }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {{ link[0] }}
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown-{{ forloop.index }}">
                {%- for childlink in link[1] -%}
                  {%- for linkparts in childlink %}
                    <li><a class="dropdown-item" href="{{ linkparts[1] | relative_url }}">{{ linkparts[0] }}</a></li>
                  {%- endfor -%}
                {%- endfor %}
              </ul>
            </div>
          {% else %}
            <a class="nav-link px-2" href="{{ link[1] | relative_url }}">{{ link[0] }}</a>
          {% endif %}
        </div>
      {%- endfor -%}

      {% if site.post_search %}
        <div class="col-auto">
          <a class="nav-link px-2" id="nav-search-link" href="#" title="Search">
            <span class="fa fa-search"></span> Search
          </a>
        </div>
      {% endif %}
    </div>
  </div>

</nav>

{% include search.html %}

<script>
  // Toggle expand/collapse on button click (for mobile)
  const expandButton = document.getElementById('expandToggle');
  const navbar = document.getElementById('main-navbar');

  expandButton?.addEventListener('click', () => {
    navbar.classList.toggle('nav-expanded');
    const expanded = navbar.classList.contains('nav-expanded');
    expandButton.setAttribute('aria-expanded', expanded);
  });

  // Optional: Close mobile nav on link click for better UX
  document.querySelectorAll('.nav-collapse a').forEach(link => {
    link.addEventListener('click', () => {
      if (window.innerWidth < 992) {
        navbar.classList.remove('nav-expanded');
        expandButton.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>
